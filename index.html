<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Join my Battle Bets League</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Keep preview identical -->
  <meta property="og:type"        content="website" />
  <meta property="og:title"       content="Join my Battle Bets League!" />
  <meta property="og:description" content="The world's first app for simulated sports betting leagues. Fake money. Real fun." />
  <meta property="og:image"       content="https://cdn.prod.website-files.com/6797de532bc3b2461a7039ff/6889824bd4161c300cd7753b_social-sharing.png" />
  <meta property="og:url"         content="https://join.battlebets.app/join" />
  <meta name="robots" content="noindex" />

  <style>
    :root { color-scheme: dark light; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b1420; color:#fff; margin:0; min-height:100dvh; display:grid; place-items:center; padding:24px; }
    .card { width:100%; max-width:560px; padding:24px; background:#132235; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25) }
    h1 { margin:0 0 8px }
    p  { margin:8px 0 }
    .btn { display:block; text-align:center; padding:14px 16px; border-radius:12px; text-decoration:none; font-weight:600; margin:12px 0 }
    .btn-primary { background:#3bd17f; color:#0b1420 }
    .btn-ghost { background:transparent; border:1px solid #3bd17f; color:#3bd17f }
    .warn { background:#2b3a52; padding:10px 12px; border-radius:10px; margin-top:12px; font-size:14px; opacity:.95; display:none; }
    .muted { opacity:.8; font-size:14px }
    .link-green { color:#3bd17f; text-decoration:none; font-weight:600; }
    .link-green:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Welcome to Battle Bets</h1>
    <p>You've been invited to join a Battle Bets League.</p>

    <h3 style="margin-top:32px;">Use iOS App (recommended)</h3>
    <p class="muted" style="margin-top:16px;">You will need the Battle Bets app installed before you can join a league.</p>

    <a id="openBtn" class="btn btn-primary" href="#">Join League (App Required)</a>
    <a id="downloadBtn" class="btn btn-ghost" href="#">Download Battle Bets</a>

    <div id="hint" class="warn">
      If nothing happens, open this page in Safari, then tap <b>Join League</b> again.
    </div>

    <h3 style="margin-top:32px;">Use Web App</h3>
    <p class="muted">No iPhone? You can use Battle Bets in your browser.</p>
    <a id="webBtn" class="btn btn-ghost" href="#">Join League on Web</a>

    <p class="muted" style="margin-top:16px;">
      Need more info? <a class="link-green" href="https://battlebets.app" target="_blank" rel="noopener">battlebets.app</a>
    </p>
  </div>

  <script>
    (function () {
      const qs   = new URLSearchParams(location.search);
      const pool = qs.get('pool_id') || '';
      const tok  = qs.get('token')   || '';

      // Handoff target on the AASA host (allowed for Universal Links)
      const OPEN_UL = `https://aasa.battlebets.app/join?pool_id=${encodeURIComponent(pool)}&token=${encodeURIComponent(tok)}`;
      
      // Join via web app
      const WEB_JOIN    = `https://play.battlebets.app/join?pool_id=${encodeURIComponent(pool)}&token=${encodeURIComponent(tok)}`;

      // App Store (no timed website fallback)
      const APP_STORE = 'https://apps.apple.com/us/app/battle-bets/id6738606749';

      // Detect in-app webviews that often block deep linking
      const ua = navigator.userAgent.toLowerCase();
      const hostile =
        ua.includes('instagram') || ua.includes('snapchat') ||
        ua.includes('fbav') || ua.includes('fbios') || ua.includes('tiktok');
      if (hostile) document.getElementById('hint').style.display = '';

      // Join â†’ hop to AASA host UL (iOS hands off to the app if installed;
      // if not installed, your aasa hostâ€™s page will prompt to download)
      document.getElementById('openBtn').onclick = async function (e) {
        e.preventDefault();
        if (hostile) {
          // optional: copy link so user can paste into Safari if blocked
          try { await navigator.clipboard.writeText(OPEN_UL); } catch (_) {}
        }
        location.href = OPEN_UL;
      };

      // Download â†’ App Store (no website fallback)
      document.getElementById('downloadBtn').onclick = function (e) {
        e.preventDefault();
        location.href = APP_STORE;
      };

      // ðŸ”— Web join button
      document.getElementById('webBtn').onclick = function (e) {
        e.preventDefault();
        location.href = WEB_JOIN;
      };
    })();
  </script>
</body>
</html>
